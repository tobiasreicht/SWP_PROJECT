// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String     @id @default(cuid())
  email     String     @unique
  username  String     @unique
  displayName String
  password  String
  avatar    String?
  bio       String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  ratings   Rating[]
  watchlist WatchlistItem[]
  friends   Friend[] @relation("UserFriends")
  friendOf  Friend[] @relation("FriendUser")
}

model Movie {
  id          String   @id @default(cuid())
  tmdbId      Int      @unique
  title       String
  description String
  releaseDate DateTime
  type        String   @default("movie") // "movie" or "series"
  genres      String   // JSON array as string
  director    String?
  cast        String   // JSON array as string
  poster      String
  backdrop    String
  runtime     Int?
  rating      Float
  createdAt   DateTime @default(now())

  ratings   Rating[]
  watchlist WatchlistItem[]
}

model Rating {
  id        String   @id @default(cuid())
  userId    String
  movieId   String
  rating    Int
  review    String?
  watchedDate DateTime?
  isFavorite Boolean @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  movie Movie @relation(fields: [movieId], references: [id], onDelete: Cascade)

  @@unique([userId, movieId])
}

model WatchlistItem {
  id        String   @id @default(cuid())
  userId    String
  movieId   String
  priority  String   @default("medium") // "high", "medium", "low"
  status    String   @default("planned") // "planned", "watching", "watched"
  notes     String?
  addedAt   DateTime @default(now())

  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  movie Movie @relation(fields: [movieId], references: [id], onDelete: Cascade)

  @@unique([userId, movieId])
}

model Friend {
  id        String   @id @default(cuid())
  userId    String
  friendId  String
  status    String   @default("pending") // "pending", "accepted", "blocked"
  createdAt DateTime @default(now())

  user   User @relation("UserFriends", fields: [userId], references: [id], onDelete: Cascade)
  friend User @relation("FriendUser", fields: [friendId], references: [id], onDelete: Cascade)

  @@unique([userId, friendId])
}
